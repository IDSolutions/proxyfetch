<?php
DEFINE("IN_APP", "true");
//DEFINE('REMOTE_API', 'http://localhost:8000/api');
//DEFINE('API_AUTH', "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjcxMzQ0MjZhMzYxNTgzZTM2YTg0YjU5YjAzOWU3M2VjM2ExMjNjNGJlYThhM2M1NjY4YjQyZDUxYmU1MDZlYjUzMWM2MzQyOThiN2RjN2IwIn0.eyJhdWQiOiIxIiwianRpIjoiNzEzNDQyNmEzNjE1ODNlMzZhODRiNTliMDM5ZTczZWMzYTEyM2M0YmVhOGEzYzU2NjhiNDJkNTFiZTUwNmViNTMxYzYzNDI5OGI3ZGM3YjAiLCJpYXQiOjE1MTAyNjA5ODYsIm5iZiI6MTUxMDI2MDk4NiwiZXhwIjoxNTQxNzk2OTg2LCJzdWIiOiJVU1I1OWZiNmNhNTNlNDEzIiwic2NvcGVzIjpbXX0.2wyZCDWkTjo56JPKcu-ikTPtlsDUT1L7s3jvBvfWsd82foAUZqFoHS1LYAR6-0M5vrM6qZBBhdnWFdG7mGeRqaFRq3GN5G3okFtzSD5ZslhxbvM1vWGLJ1hjHDdGAXBbQmUzBpWKS0oBhPeyZQ8ZHjniFe_aqpIpdVDutyhQChBB9YoBaCfNiS4ItZsa1cnwX7h0-1klarRTK7jTBbNIYtTNcYlsg9TPlAaRjuPATYeN3Db0-t7wB64Az0JXjutuEaj-46JYjT8RUMnMjZqC3-CX2PwTXtEIidoTKtUyctURa2qNI_CbVLMIb11vPMnqLqdufRxyDR6VcOQ2iGwcwSU_rIZ2qU6V4QiFwJmV6SqoX4fd-fezijznNdyT_BqsgwjmdrBOFE8-ZQdYdQUx743SZq3PIh3DjC_Z1HgP4tbuCz6PIhtPPOLNvjUooAghEmmN2bQ2nN-Z_cyWSYTB-9CP7yR9aK1igUDCSno7PTfg5qA9aaZVJmBazBP_nAB7cpNvER6zXuL0Jz3y2kZcdzMyGpzwX9CmP3QSluDkYBO9caXrhMGpa7EadHuwi2dIP5ncjXrj15JiLOzGVkaQr2VJ_zbTZl9xy9yq2mw6zVzXGCu0Z1n6jf1s3Rxzo2q9Gdu0-A34yqMyqDTxGSblPaSD9YKzs4rkc4rm2yx_r4k");

DEFINE('REMOTE_API', 'http://192.35.252.40/api');
DEFINE('API_AUTH', "eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6IjA4NWJjNTU3NDYxNzI2MmNlZGE2ZDMxMmNlM2YyNzRjOTM4Mjc3NzIxMDc0YzNhZmEyYmU3OWQ2MGViNmU1ZTBkYjc0NmJjMjRjOTI5OTdkIn0.eyJhdWQiOiI1IiwianRpIjoiMDg1YmM1NTc0NjE3MjYyY2VkYTZkMzEyY2UzZjI3NGM5MzgyNzc3MjEwNzRjM2FmYTJiZTc5ZDYwZWI2ZTVlMGRiNzQ2YmMyNGM5Mjk5N2QiLCJpYXQiOjE1MTIwNzA1MjksIm5iZiI6MTUxMjA3MDUyOSwiZXhwIjoxNTQzNjA2NTI5LCJzdWIiOiJVU1I1OWZiNmNhNDlkMTY4Iiwic2NvcGVzIjpbXX0.h2KUFVUQM3ernQqMy99KT_OgMjkaeHan9zl8AeYn0TA7kNkKrTGH3sfDbvNOJxi1wjF-skatThN7pnGh35tfWvaw7I8LhtunYHkgkh2K6KLYuKI6cGcN8V5le9TIJZ3OFTLhipRv8yrrSwJTndliwFluqZW-9YJP-_bXGYwNS_4FTbIQTcGb9BvPX64bttynaXb27x6jYTiIdBkTZRUDzri3tG8_QX0jx8mNipoH-lsEcY5c93R-SExx1K7qvdP5aZOAPJrlAzk5ndI4rMZ3rE8_C2DtV7grDwleI5oHyaUbPKEiUHYq-MfxbChEW8dSd2OBmMmxlFWgESS8ItCzninOm33JeRem0ysNkwpLn2EOXNjd0faKuTOFkETUHqQtGRg3z5dvJ8LMv7abm1jP0164HtmOXQFHNZ1K3IWHrfoIYmtLbTifv-oGhZMkuj2u9kCMzw0V3Dq7MK3xB3sC_179CkO99ObFISxaXv7fSutQp5AiIx1gu6fnUGAoqycHLp6cPxPVsSCRgw1dYdEcPXE9D-Zr3smw05s0SXa-RkDoDiGVfjakl9b14Ernr-XlWQiQdZrpbvkKIEBPq7CQFcT3Awh4PpsUb74DC-xdfOsxRN9yfgQ_0YDXnk21daJ3NwBXdOPyWoXGbi_2wM7wdqAkL7lruLOjxfKJvGcRoJ8");


/*are you brave enough to go beyond this line? */

require_once __DIR__."/vendor/autoload.php";
require_once __DIR__."/includes/lib.php";
require_once __DIR__."/cred.php";

require_once ("sources/vidyo.php");
require_once ("sources/lifesize.php");
require_once ("sources/polycom.php");

use \GuzzleHttp as GuzzleHttp;

ini_set('max_execution_time', 3600);
ini_set('memory_limit', "3072M");
ini_set('upload_max_filesize', "3072M");
ini_set('post_max_size', "3072M");


// authenticate
$credentials = base64_encode('bbriggs@e-idsolutions.com:ids_14701');


$headers = [
  //  'Authorization' => 'Basic ' . $credentials,
    "authorization" => "Bearer " . API_AUTH,
    'Accept'        => 'application/json',
];


foreach (SOURCES as $index=>$source) {
    echo "\n\nFetching ". $source." (".(ENDPOINTS[$index]).")\n-----------------------\n";

    $config = array("endpoint" => ENDPOINTS[$index], "headers" => $headers);


    try {



  //  if($index ==0) // 2, 3, ...
    switch (strtolower($source)) {

        case 'vidyo':

            $config = array_merge($config, array(
                'limit' => 10000,
                "database" => "portal2",
                "table" => "ConferenceCall2",
            ), ENDPOINTS_DETAILS[$index]);

            echo vidyo($config);
            break;

        case 'polycom':

            $config = array_merge($config, array(
                'limit' => 10000,
                'go_back_days' => 2920, // if we didnt find last record in idsuite go back x days
                "port" => "8443",
                "query" => "api/rest/billing"
            ), ENDPOINTS_DETAILS[$index]);

            echo polycom($config);
            break;

        case 'lifesize':
            $config = array_merge($config, ENDPOINTS_DETAILS[$index]);
            echo lifesize($config);
            break;


    }

    }catch (Exception $e) {

        echo 'Error: ' .$e->getMessage();

    }

} // end foreach


die("****** END OF SCRIPT *******");